<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TekeTeke — Role Selection</title>
  <style>
    :root{
      /* Sky blue + white theme */
      --bg1:#0ea5e9; --bg2:#0369a1; /* background gradient (sky-500 → sky-700) */
      --fg:#ffffff;                 /* white lettering */
      --muted:rgba(255,255,255,.92);/* more visible supporting text */
      --card1:#38bdf8; --card2:#0284c7; /* card gradient (sky-400 → sky-600) */
      --border:rgba(255,255,255,.28);   /* slightly stronger border for contrast */
      --ring:#0ea5e9;              /* focus ring */
      --link:#ffffff;              /* link text */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:17px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:linear-gradient(180deg,var(--bg1) 0%,var(--bg2) 100%);color:var(--fg);font-weight:500;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased}
    .wrap{max-width:1100px;margin:0 auto;padding:28px}
    header{display:flex;align-items:center;gap:14px;margin-bottom:22px}
    .logo{width:36px;height:36px;border-radius:10px;background:radial-gradient(120% 120% at 20% 10%, #7dd3fc 0%, #38bdf8 40%, #0284c7 80%);box-shadow:0 0 0 4px rgba(255,255,255,.08), 0 8px 24px rgba(14,165,233,.40)}
    h1{font-size:28px;margin:0 6px 0 0;letter-spacing:.3px;font-weight:900;text-shadow:0 1px 1px rgba(0,0,0,.25)}
    h2{font-size:20px;margin:0 0 8px 0;font-weight:800;text-shadow:0 1px 1px rgba(0,0,0,.2)}
    .muted{color:var(--muted);font-weight:600}

    .panel{background:linear-gradient(180deg,var(--card1) 0%,var(--card2) 100%);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
    .grid{display:grid;grid-template-columns:1fr;gap:18px}

    .dash-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}
    @media (max-width: 860px){.dash-grid{grid-template-columns:1fr}}
    .card{border:1px solid var(--border);background:linear-gradient(180deg,rgba(14,165,233,.20) 0%,rgba(2,132,199,.26) 100%);border-radius:16px;padding:18px;display:flex;flex-direction:column;gap:10px;box-shadow:0 6px 22px rgba(0,0,0,.25)}
    .card h3{margin:0;font-size:20px;font-weight:800;letter-spacing:.2px;text-shadow:0 1px 1px rgba(0,0,0,.18)}
    .card p{margin:0}
    .card .actions{margin-top:auto;display:flex;gap:10px;align-items:center}

    .link{display:inline-flex;align-items:center;gap:8px;padding:12px 14px;border-radius:12px;border:2px solid var(--border);background:rgba(255,255,255,.10);color:var(--fg);text-decoration:none;font-weight:800;font-size:16px;text-shadow:0 1px 1px rgba(0,0,0,.18)}
    .link:hover{background:rgba(255,255,255,.14)}

    .pill{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.35);background:rgba(255,255,255,.12);font-weight:700}

    footer{margin-top:22px;color:var(--muted);font-size:12px;font-weight:600}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <h1>TekeTeke · Role Selection</h1>
      <span id="envTag" class="pill muted"></span>
      
    </header>

    <div class="grid">
      <!-- Dashboards only (simplified) -->
      <section class="panel">
        <h2 style="margin:0 0 8px 0;font-size:18px">Dashboards</h2>
        <p class="muted" style="margin-top:0">Choose your console.</p>
        <div class="dash-grid">
          <div class="card">
            <h3>System Admin</h3>
            <p>Platform‑wide controls, USSD pool, rulesets, and system overview.</p>
            <div class="actions">
              <a class="link" href="/admin.html">Open System Admin</a>
            </div>
          </div>

          <div class="card">
            <h3>SACCO Admin</h3>
            <p>Manage your SACCO: members, matatus, pricing, and reports.</p>
            <div class="actions">
              <a class="link" href="/sacco/admin.html">Open SACCO Admin</a>
            </div>
          </div>

          <div class="card">
            <h3>SACCO Staff</h3>
            <p>Daily ops & listings for staff users within a SACCO.</p>
            <div class="actions">
              <a class="link" href="/sacco/sacco.html">Open SACCO Staff</a>
            </div>
          </div>

          <div class="card">
            <h3>Matatu Owner</h3>
            <p>Owner console for fleet insight and balances.</p>
            <div class="actions">
              <a class="link" href="/matatu/owner.html">Open Owner Console</a>
            </div>
          </div>

          <div class="card">
            <h3>Conductor</h3>
            <p>Quick actions and daily records.</p>
            <div class="actions">
              <a class="link" href="/conductor/console.html">Open Conductor Console</a>
            </div>
          </div>
        </div>
      </section>
    </div>

    <footer>
      Need login helpers again? We can add a small token toggle later — for now this page is focused on navigation only.
    </footer>
  </div>

  <script>
    // Environment tag (tries to infer from host)
    (function(){
      const tag = (location.host.includes('vercel.app') ? 'Preview' : (location.host.endsWith('.app')? 'Production' : 'Local'));
      document.getElementById('envTag').textContent = tag;
    })();
  </script>
</body>
</html>

<script>
(function autoContinueIfLoggedIn(){
  try{
    const tok = localStorage.getItem('auth_token');
    if (!tok) return;
    fetch('/api/my-roles', { headers: { Authorization: 'Bearer ' + tok }})
      .then(r => r.ok ? r.json() : null)
      .then(j => {
        if (!j) return;
        const data = j.data || j || {};
        const saccos = Array.isArray(data.saccos) ? data.saccos : [];
        const matatus = Array.isArray(data.matatus) ? data.matatus : [];
        const roles = [];
        if (saccos.some(r => String(r.role||'').toUpperCase() === 'SACCO_ADMIN')) roles.push('SACCO_ADMIN');
        if (!roles.length && saccos.length) roles.push('SACCO_STAFF');
        if (matatus.some(r => String(r.member_role||'').toLowerCase() === 'owner')) roles.push('MATATU_OWNER');
        if (matatus.some(r => String(r.member_role||'').toLowerCase() === 'conductor')) roles.push('CONDUCTOR');
        if (roles.length > 1) {
          try { sessionStorage.setItem('last_roles', JSON.stringify(roles)); } catch {}
          return; // let user pick
        }
        const go = (path) => setTimeout(()=> location.href = path, 600);
        if (roles.includes('SACCO_ADMIN')) return go('/sacco/admin.html');
        if (roles.includes('SACCO_STAFF')) return go('/sacco/sacco.html');
        if (roles.includes('MATATU_OWNER')) return go('/matatu/owner.html');
        if (roles.includes('CONDUCTOR')) return go('/conductor/console.html');
      })
      .catch(()=>{});
  }catch{}
})();
</script>
